<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<project default="make-full" name="Crea il jar per la distribuzione">

	<property name="app-name" value="ClipboardBoss" />
	<property name="bin-dir" value="../bin" />
	<property name="jar-dir" value="../jar" />

	<tstamp>
		<format property='build-time' pattern='dd-MM-yyyy HH:mm:ss' />
	</tstamp>

	<path id="build.classpath">
		<fileset dir="${user.home}/IzPack">
			<include name="lib/*.jar" />
		</fileset>
	</path>

	<!-- taskdef name="jarbundler"
	             classpath="${user.home}/jarbundler-2.3.1/jarbundler-2.3.1.jar" 
	             classname="net.sourceforge.jarbundler.JarBundler" / -->

	<taskdef name="izpack" classpathref="build.classpath" classname="com.izforge.izpack.ant.IzPackTask" />

	<target name="make-jar">
		<buildnumber file="${app-name}.buildnumber" />
		<jar basedir="${bin-dir}" destfile="${jar-dir}/${app-name}-${build.number}.jar">
			<manifest>
				<attribute name="Built-By" value="${user.name}" />
				<attribute name="Built-On" value="${os.name}" />
				<attribute name="Built-At" value="${build-time}" />
				<attribute name="Build-Jdk" value="1.6" />
				<section name="${app-name}" >
					<attribute name="Implementation-Title" value="${app-name}" />
					<attribute name="Implementation-Version" value="${build.number}" />
					<attribute name="Implementation-Vendor" value="Luca Rocci" />
				</section>
				<attribute name="Main-Class" value="it.rocci.clipboss.MainApp"/>
				<attribute name="Class-Path" value="."/>
			</manifest>
		</jar>
		<copy file="${jar-dir}/${app-name}-${build.number}.jar" tofile="../${app-name}.jar"/>
	</target>

	<target name="make-full">
		<antcall target="make-jar" />
		<antcall target="make-install" />
		<antcall target="make-exe" />
		<antcall target="make-app" />
	</target>

	<!-- target name="make-bundle">
		<jarbundler dir="../" verbose="true" showPlist="true"
                name="${app-name}"
                mainclass="it.rocci.clipboss.MainApp"
                jar="../${app-name}.jar"
                icon="../${app-name}.icns"
                version="1.0"
                copyright="Copyright &#xa9; 2015 Luca Rocci"
				shortname="Clipboard Boss"
    			jvmversion="1.6+"
				infostring="$Clipboard Boss, Copyright &#xa9; 2015 Luca Rocci"
				build="1.0"
				bundleid="it.rocci.clipboss.MainApp" >

			<javaproperty name="apple.laf.useScreenMenuBar" value="true"/>
			<javaproperty name="apple.awt.brushMetal" value="true"/>
			<javaproperty name="apple.awt.showGrowBox" value="false"/>

		</jarbundler>
	</target -->

	<target name="make-install">
		<izpack input="installer.xml"
                output="${basedir}/installer/${app-name}-uni.jar"
                installerType="standard"
                inheritAll="true"
                basedir="${basedir}"
                izPackDir="${user.home}/IzPack/" />
	</target>

	<target name="make-app">
		<exec executable="C:\Python34\python.exe" failonerror="true">
			<arg line="${user.home}\IzPack\utils\wrappers\izpack2app\izpack2app2.py"/>
			<arg line="${basedir}\installer\${app-name}-uni.jar"/>
			<arg line="${basedir}\installer\${app-name}-macosx.app"/>
		</exec>
	</target>

	<target name="make-exe">
		<exec executable="C:\Python34\python.exe" failonerror="true">
			<arg line="${user.home}/IzPack/utils/wrappers/izpack2exe/izpack2exe.py"/>
			<arg line="--file=${basedir}/installer/${app-name}-uni.jar"/>
			<arg line="--output=${basedir}/installer/${app-name}-win.exe"/>
			<arg line="--no-upx"/>
			<arg line="--with-7z=${user.home}/IzPack/utils/wrappers/izpack2exe/7za.exe"/>
			<arg line="--launch-file=${app-name}-uni.jar"/>
			<arg line="--name=${app-name}"/>
		</exec>
	</target>

	<target name="make-exe-yes">
		<exec executable="C:\Python34\python.exe" failonerror="true">
			<arg line="${user.home}/IzPack/utils/wrappers/izpack2exe/izpack2exe.py"/>
			<arg line="--file=${basedir}/${app-name}-10.jar"/>
			<arg line="--output=${basedir}/${app-name}-java-install.exe"/>
			<arg line="--with-upx=${user.home}/IzPack/utils/wrappers/izpack2exe/upx.exe"/>
			<arg line="--with-7z=${user.home}/IzPack/utils/wrappers/izpack2exe/7za.exe"/>
			<arg line="--name=${app-name}"/>
		</exec>
	</target>

</project>
